# norms_anomalies_TS

Материалы для статьи с рабочим названием "ИЗМЕНЧИВОСТЬ АНОМАЛИЙ ТЕМПЕРАТУРЫ И СОЛЕНОСТИ ВОД В АВГУСТЕ-СЕНТЯБРЕ НА РАЗРЕЗЕ «КОЛЬСКИЙ МЕРИДИАН» ЗА ПЕРИОД С 1970 ПО 2019 ГГ." (Моисеев Д.В., Запорожцев И.Ф., Максимовская Т.М., план завершения - сентябрь 2020 г.). Веб-приложение и набор утилит, которые обрабатывают данные World Ocean Database и ICES для обновления референсных значений океанографических характеристик (норм и аномалий) на разрезе "Кольский Меридиан" и построения отчетных изображений для лаб. ОиР ММБИ РАН. 

![Превью](https://github.com/ZifRD/norms_anomalies_TS/blob/master/pics/Area.png)

Входные данные: WOD (World Ocean Database 2018, https://www.nodc.noaa.gov/OC5/SELECT/dbsearch/dbsearch.html), ICES (oceanographic database of the International Council for the Exploration of the Sea, https://www.ices.dk/data/data-portals/Pages/ocean.aspx) и локальные данные ММБИ (25 экспедиций 2000-2019 гг., данные которых отсутствуют в WOD и ICES). Использованы 12579 станций (вертикальных профилей in situ) для температуры и 7023 для солёности. Период: 1970-2019 гг.

Значения WOD извлекаются из ASCII-формата, представленого на портале NOAA, и переформатируются в текстовый табличный формат (CSV со столбцами для месяца, года и строки "ключ-значений" в виде пар "горизонт-измеренная величина". Далее строится массив восстановленных значений в узлах сетки, ипользуемой в расчёте норм (вертикальный шаг - 5 м, шаг вдоль меридиана - 0.5 градуса). Данные ICES также представлены в текстовом формате, локальные данные ММБИ - множество .xlsx файлов (широта, долгота, глубина, температура, солёность). Данные ICES и ММБИ обрабатываются аналогично массиву WOD. Внутренний формат хранит для каждого узла сетки и каждого месяца пару упорядоченных списков: значения характристики и соответствующие годы. Норма для "узел-месяц" - это среднее арифметическое для списка значений характеристики, а при вычислении аномалий задействован и второй список. Каждое измеренное значение вносит вклад только в одну пару "узел-месяц". Длина списков для этих пар сильно варьируется в зависимости от положения станции на разрезе (высокие широты сложно исследовать из-за особенностей климата, в частности, ледовых условий), горизонта (более ранние измерения выполнялись с шагом 25 или 50 м, нынешние - 1 м), месяца (вновь лёд).

Внешний доступ к вычислениям норм/аномалий происходит с помощью веб-приложения, реализованного на R с помощью фреймворка shiny. Основные настройки (левая панель): (1) целевая характеристика, (2) промежуток времени как подмножество периода 1970-2019 гг. Далее по нажатию кнопки вычисляются нормы и экспортируются в *.xlsx. Пользователь может добавить свои собственные .xlsx (левая панель) для расчёта норм с учётом них (для примера выложен файл sample.xlsx) - по такому принципу были добавлены файлы ММБИ. Имеется кнопка для удаления добавленных файлов. Основная панель (построения аномалий) имеет настройки: референсный месяц и два варианта расчёта аномалий - для всех лет и станций, что использовались при расчёте норм, либо для конкретной экспедиции (нужно загрузить .xlsx, необязательно использованный ранее для подсчёта норм; можно также применить sample.xlsx). Результат расчёта аномалий также экспортируется в .xlsx.

Далее перечислены файлы, которые содержат сниппеты построения различных изображений по данным, с которыми работает веб-приложение. После генерации изображения были обработаны в Gimp (в частности, могли использоваться несколько сгенерированных изображений в итоговом). 

1. Распределение количества станций по месяцам (для измерений температуры и солёности). Различные столбцы для случаев: (a) все станции, (b) первые десять стандартных станций на разрезе "Кольский меридиан".

![Figure 1](https://github.com/ZifRD/norms_anomalies_TS/blob/master/pics/Figure%201.PNG)

2. Группировка станций по значениям норм 2000 года и новых норм 2020 г. океанографических характеристик методом PCA (для каждого месяца по 4 блока в следующем порядке: старые и новые для температуры, старые и новые нормы солёности); для группировки станций по принадлежности к течениям проведены горизонтальные прямые (цвет фона подчёркивает заток более тёплых вод), вертикальные штриховые прямые для случаев отсутствия данных.

![Figure 2](https://github.com/ZifRD/norms_anomalies_TS/blob/master/pics/Figure%202.PNG)

3. Обеспеченность данными по дням с 1 июля по 1 ноября каждого года с 1970 г. по 2019 г., зелёным цветом показаны 30-дневные фрагменты с центральной точкой - датой начала осени как сезона атмосферной циркуляции по Дзердзеевскому (http://atmosphericcirculation.ru/datas/), вертикальные прямые красного цвета - границы гидрологического предосенья (месяца), определяемые для Баренцева моря (см. Макаревич, П. Р., Дружкова, Е. И. Сезонные циклические процессы в прибрежных планктонных альгоценозах северных морей. - Ростов-на-Дону, 2010. – 280 с.).

![Figure 3](https://github.com/ZifRD/norms_anomalies_TS/blob/master/pics/Figure%203.PNG)

4. Старые (a) и новые (b) нормы температуры (предосенье). 

![Figure 4](https://github.com/ZifRD/norms_anomalies_TS/blob/master/pics/Figure%204.PNG)

5. Периодограммы для 3х течений и различных слоёв: исходные ряды аномалий температуры (a) и первые разности (b); красные вертикальные прямые - границы области спектра с периодами от 3 до 20 лет, а также верхняя граница доверительного интервала (красный шум AR(1), p = 0,95) как ограничения для идентификации значимых пиков.

![Figure 5](https://github.com/ZifRD/norms_anomalies_TS/blob/master/pics/Figure%205.PNG)

6. Матрица взвешенных корреляций (a) и результат восстановления аддитивных компонент (b) ряда аномалий температуры (течение №2, слой “0 м-дно”).

![Figure 6](https://github.com/ZifRD/norms_anomalies_TS/blob/master/pics/Figure%206.PNG)


